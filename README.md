[![Build Status](https://travis-ci.org/tsucchi/p5-Test-DataLoader.png?branch=master)](https://travis-ci.org/tsucchi/p5-Test-DataLoader) [![Coverage Status](https://coveralls.io/repos/tsucchi/p5-Test-DataLoader/badge.png?branch=master)](https://coveralls.io/r/tsucchi/p5-Test-DataLoader?branch=master)
# NAME

Test::DataLoader - Load testdata into database

# SYNOPSIS

    use Test::DataLoader;
    use DBI;
    my $dbh = DBI->connect(...);
    my $data = Test::DataLoader->new($dbh);
    #
    # define/add testdata
    $data->add('some_table', 1, {# data_href: column => value
        id   => 1, 
        name => 'aaa',
    }, ['id']); # primary keys
    $data->add('foo', 2, {
        id   => 2,
        name => 'bbb',
    }, ['id']);
    #
    # load data into database
    $data->load('foo', 1); 
    #
    # load data into database and got loaded data
    my $loaded = $data->load('foo', 2); # $loaded => { id => 2, name => 'bbb' }
    # ... tests using database
    $data->clear;# when finished

    #
    # if table has auto_increment
    #
    $data->add('foo', 1, {
                 name => 'aaa',
    }, ['id']); #id is auto_increment column
    my $keys = $data->load('foo', 1);#load data and get auto_increment
    is( $keys->{id}, 2); # get key value(generated by auto_increment)
    # ... tests using database
    $data->clear;# when finished

    #
    # read from external file
    #
    # employee.pl
    +{
        # table_name can be omitted. In this case, filename(except .pl) is used for table_name.
        # table_name => 'employee',
        data => {
            1 => {
                id   => 123,
                name => 'aaa',
            },
        },
        unique_keys => ['id'],
    }
    # this file is same as 
    # $data->add('employee', 1, { id => 123, name => 'aaa' }, ['id']);
    #
    # in your testcode
    my $data = Test::DataLoader->new($dbh);
    $data->add_by_file('path/to/employee.pl');
    $data->load('employee', 1);
    # ... tests using database
    $data->clear;# when finished

# DESCRIPTION

Test::DataLoader is testdata loader to database.

# AUTHOR

Takuya Tsuchida <tsucchi {at} cpan.org>

# SEE ALSO

# LICENSE

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.
